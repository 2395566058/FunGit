<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="keilen.local.mapper.PostFloorMapper">
	<resultMap type="keilen.local.util.ShowPostReviewUtil" id="postReviewMap">
		<result property="floor" column="floor"/>
		<result property="content" column="content"/>
		<result property="issuetime" column="issuetime"/>
		<association property="useName" column="userid" select="keilen.local.mapper.UserPersonalMapper.getNameById" />
	</resultMap>
	<resultMap id="floorMap" type="keilen.local.util.ShowPostUtil">
		<result property="floor" column="floor"/>
		<result property="content" column="content"/>
		<result property="issuetime" column="issuetime"/>
		<association property="useName" column="userid" select="keilen.local.mapper.UserPersonalMapper.getNameById" />
		<association property="useHead" column="userid" select="keilen.local.mapper.UserPersonalMapper.getHeadById" />
		<association property="review"  column="reviewid" select="keilen.local.mapper.PostFloorMapper.getFloorByid" />
	</resultMap>	
	<select id="getCountByPostid" parameterType="String" resultType="int">
		select count(*) from post_floor where postid=#{postid}
	</select>
	
	<insert id="insertOne" parameterType="PostFloor">
		insert into post_floor (id,postid,floor,content,userid,issuetime
		<if test="reviewid!=null">
			,reviewid
		</if>
		) values (id,#{postid},#{floor},#{content},#{userid},#{issuetime}
		<if test="reviewid!=null">
			,#{reviewid}
		</if>
		)
	</insert>
	
	<select id="getCountByPostidAndFloor" parameterType="String" resultType="int">
		select count(*) from post_floor where postid=#{postid} and floor=#{floor}
	</select>
	
	<select id="getFloorsById" resultMap="floorMap">
		select floor,content,userid,issuetime,reviewid from post_floor where postid=#{postid} and floor&gt;=#{head} and floor&lt;=#{foot}
	</select>
	
	<select id="getFloorByid" resultMap="postReviewMap">
		select floor,content,userid,issuetime from post_floor where id=#{reviewid}
	</select>
	
	<select id="getIdByPostidAndFloor" parameterType="String" resultType="String">
		select id from post_floor where postid=#{postid} and floor=#{floor}
	</select>
</mapper>